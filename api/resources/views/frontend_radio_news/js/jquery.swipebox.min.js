/*---------------------------------------------------------------------------------------------

@author       Constantin Saguin - @brutaldesign
@link            http://csag.co
@github        http://github.com/brutaldesign/swipebox
@version     1.2.1
@license      MIT License

----------------------------------------------------------------------------------------------*/
!function(window,document,$,undefined){$.swipebox=function(elem,options){var defaults={useCSS:!0,useSVG:!0,initialIndexOnArray:0,removeBarsOnMobile:!0,hideCloseButtonOnMobile:!1,hideBarsDelay:3e3,videoMaxWidth:1140,vimeoColor:"cccccc",beforeOpen:null,afterOpen:null,afterClose:null,loopAtEnd:!1,autoplayVideos:!1,queryStringData:{},toggleClassOnLoad:""},plugin=this,elements=[],elem,selector=(elem=elem).selector,$selector=$(selector),isTouch=void 0!==document.createTouch||"ontouchstart"in window||"onmsgesturechange"in window||navigator.msMaxTouchPoints,supportSVG=!!window.SVGSVGElement,winWidth=window.innerWidth?window.innerWidth:$(window).width(),winHeight=window.innerHeight?window.innerHeight:$(window).height(),html='<div id="swipebox-overlay">\t\t\t\t<div id="swipebox-slider"></div>\t\t\t\t<div id="swipebox-caption"></div>\t\t\t\t<div id="swipebox-action">\t\t\t\t\t<a id="swipebox-close"></a>\t\t\t\t\t<a id="swipebox-prev"></a>\t\t\t\t\t<a id="swipebox-next"></a>\t\t\t\t</div>\t\t</div>';plugin.settings={},plugin.init=function(){plugin.settings=$.extend({},defaults,options),$.isArray(elem)?(elements=elem,ui.target=$(window),ui.init(plugin.settings.initialIndexOnArray)):$selector.click((function(e){var index,relType,relVal;elements=[],relVal||(relType="rel",relVal=$(this).attr(relType)),$elem=relVal&&""!==relVal&&"nofollow"!==relVal?$selector.filter("["+relType+'="'+relVal+'"]'):$(selector),$elem.each((function(){var title=null,href=null;$(this).attr("title")&&(title=$(this).attr("title")),$(this).attr("href")&&(href=$(this).attr("href")),elements.push({href:href,title:title})})),index=$elem.index($(this)),e.preventDefault(),e.stopPropagation(),ui.target=$(e.target),ui.init(index)}))},plugin.refresh=function(){$.isArray(elem)||(ui.destroy(),$elem=$(selector),ui.actions())};var ui={init:function(index){plugin.settings.beforeOpen&&plugin.settings.beforeOpen(),this.target.trigger("swipebox-start"),$.swipebox.isOpen=!0,this.build(),this.openSlide(index),this.openMedia(index),this.preloadMedia(index+1),this.preloadMedia(index-1)},build:function(){var $this=this;if($("body").append(html),supportSVG){var bg=$("#swipebox-action #swipebox-close").css("background-image");bg=bg.replace("png","svg"),$("#swipebox-action #swipebox-prev,#swipebox-action #swipebox-next,#swipebox-action #swipebox-close").css({"background-image":bg})}$.each(elements,(function(){$("#swipebox-slider").append('<div class="slide"></div>')})),this.setDim(),this.actions(),this.keyboard(),this.gesture(),this.animBars(),this.resize()},setDim:function(){var width,height,sliderCss={};"onorientationchange"in window?window.addEventListener("orientationchange",(function(){0==window.orientation?(width=winWidth,height=winHeight):90!=window.orientation&&-90!=window.orientation||(width=winHeight,height=winWidth)}),!1):(width=window.innerWidth?window.innerWidth:$(window).width(),height=window.innerHeight?window.innerHeight:$(window).height()),sliderCss={width:width,height:height},$("#swipebox-overlay").css(sliderCss)},supportTransition:function(){for(var prefixes="transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition".split(" "),i=0;i<prefixes.length;i++)if(void 0!==document.createElement("div").style[prefixes[i]])return prefixes[i];return!1},doCssTrans:function(){if(plugin.settings.useCSS&&this.supportTransition())return!0},gesture:function(){if(isTouch){var $this=this,distance=null,swipMinDistance=10,startCoords={},endCoords={},bars=$("#swipebox-caption, #swipebox-action");bars.addClass("visible-bars"),$this.setTimeout(),$("body").bind("touchstart",(function(e){return $(this).addClass("touching"),endCoords=e.originalEvent.targetTouches[0],startCoords.pageX=e.originalEvent.targetTouches[0].pageX,$(".touching").bind("touchmove",(function(e){e.preventDefault(),e.stopPropagation(),endCoords=e.originalEvent.targetTouches[0]})),!1})).bind("touchend",(function(e){e.preventDefault(),e.stopPropagation(),(distance=endCoords.pageX-startCoords.pageX)>=10?$this.getPrev():distance<=-10?$this.getNext():bars.hasClass("visible-bars")?($this.clearTimeout(),$this.hideBars()):($this.showBars(),$this.setTimeout()),$(".touching").off("touchmove").removeClass("touching")}))}},setTimeout:function(){if(plugin.settings.hideBarsDelay>0){var $this=this;$this.clearTimeout(),$this.timeout=window.setTimeout((function(){$this.hideBars()}),plugin.settings.hideBarsDelay)}},clearTimeout:function(){window.clearTimeout(this.timeout),this.timeout=null},showBars:function(){var bars=$("#swipebox-caption, #swipebox-action");this.doCssTrans()?bars.addClass("visible-bars"):($("#swipebox-caption").animate({bottom:-50},500),$("#swipebox-action").animate({opacity:0},500),setTimeout((function(){bars.addClass("visible-bars")}),1e3))},hideBars:function(){var bars=$("#swipebox-caption, #swipebox-action");this.doCssTrans()?bars.removeClass("visible-bars"):($("#swipebox-caption").animate({opacity:"1"},500),$("#swipebox-action").animate({opacity:"1"},500),setTimeout((function(){bars.removeClass("visible-bars")}),1e3))},animBars:function(){var $this=this,bars=$("#swipebox-caption, #swipebox-action");bars.addClass("visible-bars"),$this.setTimeout(),$("#swipebox-slider").click((function(e){bars.hasClass("visible-bars")||($this.showBars(),$this.setTimeout())})),$("#swipebox-action").hover((function(){$this.showBars(),bars.addClass("force-visible-bars"),$this.clearTimeout()}),(function(){bars.removeClass("force-visible-bars"),$this.setTimeout()}))},keyboard:function(){var $this=this;$(window).bind("keyup",(function(e){e.preventDefault(),e.stopPropagation(),37==e.keyCode?$this.getPrev():39==e.keyCode?$this.getNext():27==e.keyCode&&$this.closeSlide()}))},actions:function(){var $this=this;elements.length<2?$("#swipebox-prev, #swipebox-next").hide():($("#swipebox-prev").bind("click touchend",(function(e){e.preventDefault(),e.stopPropagation(),$this.getPrev(),$this.setTimeout()})),$("#swipebox-next").bind("click touchend",(function(e){e.preventDefault(),e.stopPropagation(),$this.getNext(),$this.setTimeout()}))),$("#swipebox-close").bind("click touchend",(function(e){$this.closeSlide()}))},setSlide:function(index,isFirst){isFirst=isFirst||!1;var slider=$("#swipebox-slider");this.doCssTrans()?(width=window.innerWidth?window.innerWidth:$(window).width(),off="translate3d(-"+index*width+"px, 0, 0)",slider.css({"-webkit-transform":off,"-moz-transform":off,"-ms-transform":off,"-o-transform":off,transform:off})):slider.animate({left:100*-index+"%"}),$("#swipebox-slider .slide").removeClass("current"),$("#swipebox-slider .slide").eq(index).addClass("current"),this.setTitle(index),isFirst&&slider.fadeIn(),$("#swipebox-prev, #swipebox-next").removeClass("disabled"),0==index?$("#swipebox-prev").addClass("disabled"):index==elements.length-1&&$("#swipebox-next").addClass("disabled")},openSlide:function(index){$("html").addClass("swipebox"),$(window).trigger("resize"),this.setSlide(index,!0)},preloadMedia:function(index){var $this=this,src=null;void 0!==elements[index]&&(src=elements[index].href),$this.isVideo(src)?$this.openMedia(index):setTimeout((function(){$this.openMedia(index)}),1e3)},openMedia:function(index){var $this=this,src=null;if(void 0!==elements[index]&&(src=elements[index].href),index<0||index>=elements.length)return!1;this.isVideo(src)?$("#swipebox-slider .slide").eq(index).html(this.getVideo(src)):this.loadMedia(src,(function(){$("#swipebox-slider .slide").eq(index).html(this)}))},setTitle:function(index,isFirst){var title=null;$("#swipebox-caption").empty(),void 0!==elements[index]&&(title=elements[index].title),cleantitle=title?' <span class="title">'+title+"</span> ":" ",tot=$("#swipebox-slider .slide").length,tot>1?counter=' <span class="counter">'+(index+1)+"/"+tot+"</span> ":counter=" ",$("#swipebox-caption").append(counter+cleantitle)},isVideo:function(src){if(src&&(src.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||src.match(/vimeo\.com\/([0-9]*)/)||src.match("://(www.)?dailymotion.com")))return!0},getVideo:function(url){var success=!1;if(url.match("://(www.)?youtube|youtu.be")?(url.match("embed")?youtube_id=url.split(/embed\//)[1].split('"')[0]:youtube_id=url.split(/v\/|v=|youtu\.be\//)[1].split(/[?&]/)[0],v_id=youtube_id,i_src="http://www.youtube.com/embed/"+v_id+"?controls=1&color=white&showinfo=0&autoplay=1&hd=1&fs=1&rel=0",success=!0):url.match("://(player.)?vimeo.com")?(vimeo_Reg=/https?:\/\/(?:www\.)?vimeo.com\/(?:channels\/|groups\/([^\/]*)\/videos\/|album\/(\d+)\/video\/|)(\d+)(?:$|\/|\?)/,match=url.match(vimeo_Reg),v_id=match[3],i_src="http://player.vimeo.com/video/"+v_id+"?title=0&byline=0&portrait=0&color=ffffff&autoplay=1",success=!0):url.match("://(www.)?dailymotion.com")&&(m=url.match(/^.+dailymotion.com\/((video|hub)\/([^_]+))?[^#]*(#video=([^_&]+))?/),v_id=m?m[5]||m[3]:null,i_src="http://www.dailymotion.com/embed/video/"+v_id+"?autoplay=true&background=000000&foreground=ffffff&highlight=ffffff",success=!0),success)return iframe='<iframe width="560" height="315"  src="'+i_src+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>','<div class="swipebox-video-container" style="max-width:'+plugin.settings.videomaxWidth+'px"><div class="swipebox-video">'+iframe+"</div></div>"},loadMedia:function(src,callback){if(!this.isVideo(src)){var img=$("<img>").on("load",(function(){callback.call(img)}));img.attr("src",src)}},getNext:function(){var $this=this;index=$("#swipebox-slider .slide").index($("#swipebox-slider .slide.current")),index+1<elements.length?(index++,this.setSlide(index),this.preloadMedia(index+1)):($("#swipebox-slider").addClass("rightSpring"),setTimeout((function(){$("#swipebox-slider").removeClass("rightSpring")}),500))},getPrev:function(){index=$("#swipebox-slider .slide").index($("#swipebox-slider .slide.current")),index>0?(index--,this.setSlide(index),this.preloadMedia(index-1)):($("#swipebox-slider").addClass("leftSpring"),setTimeout((function(){$("#swipebox-slider").removeClass("leftSpring")}),500))},resize:function(){var $this=this;$(window).resize((function(){curr=$("#swipebox-slider .slide").index($("#swipebox-slider .slide.current")),$this.setDim(),$this.setSlide(curr)})).resize()},closeSlide:function(){$("html").removeClass("swipebox"),$(window).trigger("resize"),this.destroy()},destroy:function(){$(window).unbind("keyup"),$("body").unbind("touchstart"),$("body").unbind("touchmove"),$("body").unbind("touchend"),$("#swipebox-slider").unbind(),$("#swipebox-overlay").remove(),$.isArray(elem)||elem.removeData("_swipebox"),this.target&&this.target.trigger("swipebox-destroy"),$.swipebox.isOpen=!1,plugin.settings.afterClose&&plugin.settings.afterClose()}};plugin.init()},$.fn.swipebox=function(options){if(!$.data(this,"_swipebox")){var swipebox=new $.swipebox(this,options);this.data("_swipebox",swipebox)}return this.data("_swipebox")}}(window,document,jQuery);